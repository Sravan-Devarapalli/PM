(function(){var b="ExtendedCascadingDropDown";
function a(){Type.registerNamespace("AjaxControlToolkit");
AjaxControlToolkit.CascadingDropDownSelectionChangedEventArgs=function(d,c){AjaxControlToolkit.CascadingDropDownSelectionChangedEventArgs.initializeBase(this);
this._oldValue=d;
this._newValue=c
};
AjaxControlToolkit.CascadingDropDownSelectionChangedEventArgs.prototype={get_oldValue:function(){return this._oldValue
},get_newValue:function(){return this._newValue
}};
AjaxControlToolkit.CascadingDropDownSelectionChangedEventArgs.registerClass("AjaxControlToolkit.CascadingDropDownSelectionChangedEventArgs",Sys.EventArgs);
AjaxControlToolkit.CascadingDropDownBehavior=function(c){AjaxControlToolkit.CascadingDropDownBehavior.initializeBase(this,[c]);
this._parentControlID=null;
this._category=null;
this._promptText=null;
this._loadingText=null;
this._promptValue=null;
this._emptyValue=null;
this._emptyText=null;
this._servicePath=location.pathname;
this._serviceMethod=null;
this._contextKey=null;
this._useContextKey=false;
this._parentElement=null;
this._changeHandler=null;
this._parentChangeHandler=null;
this._lastParentValues=null;
this._selectedValue=null
};
AjaxControlToolkit.CascadingDropDownBehavior.prototype={initialize:function(){AjaxControlToolkit.CascadingDropDownBehavior.callBaseMethod(this,"initialize");
$common.prepareHiddenElementForATDeviceUpdate();
var c=this.get_element();
this._clearItems();
c.CascadingDropDownCategory=this._category;
this._changeHandler=Function.createDelegate(this,this._onChange);
$addHandler(c,"change",this._changeHandler);
if(this._parentControlID){this._parentElement=$get(this._parentControlID);
if(!this._parentElement){Sys.Debug.fail(String.format(AjaxControlToolkit.Resources.CascadingDropDown_NoParentElement,this._parentControlID))
}if(this._parentElement){c.CascadingDropDownParentControlID=this._parentControlID;
this._parentChangeHandler=Function.createDelegate(this,this._onParentChange);
$addHandler(this._parentElement,"change",this._parentChangeHandler);
if(!this._parentElement.childDropDown){this._parentElement.childDropDown=new Array()
}this._parentElement.childDropDown.push(this)
}}this._onParentChange(null,true)
},dispose:function(){var c=this.get_element();
if(this._changeHandler){$removeHandler(c,"change",this._changeHandler);
this._changeHandler=null
}if(this._parentChangeHandler){if(this._parentElement){$removeHandler(this._parentElement,"change",this._parentChangeHandler)
}this._parentChangeHandler=null
}AjaxControlToolkit.CascadingDropDownBehavior.callBaseMethod(this,"dispose")
},_clearItems:function(){var c=this.get_element();
while(0<c.options.length){c.remove(0)
}},_isPopulated:function(){var c=this.get_element().options.length;
if(this._promptText){return c>1
}else{return c>0
}},_setOptions:function(l,j,f){if(!this.get_isInitialized()){return
}var d=this.get_element();
this._clearItems();
var g;
var h="";
if(f&&this._loadingText){g=this._loadingText;
if(this._selectedValue){h=this._selectedValue
}}else{if(!f&&l&&(0==l.length)&&(null!=this._emptyText)){g=this._emptyText;
if(this._emptyValue){h=this._emptyValue
}}else{if(this._promptText){g=this._promptText;
if(this._promptValue){h=this._promptValue
}}}}var q;
if(g){q=new Option(g,h);
d.options[d.options.length]=q
}var r=null,c=-1;
if(l){for(i=0;
i<l.d.length;
i++){var k=l.d[i],m=k.name,o=k.value,n=k.name;
if(k.isDefaultValue){c=i;
if(this._promptText){c++
}}q=new Option(m,o);
if(o==this._selectedValue){r=q
}if(n){q.setAttribute("title",n)
}d.options[d.options.length]=q
}if(r){r.selected=true
}}if(r){this.set_SelectedValue(d.options[d.selectedIndex].value,d.options[d.selectedIndex].text)
}else{if(!r&&c!=-1){d.options[c].selected=true;
this.set_SelectedValue(d.options[c].value,d.options[c].text)
}else{if(!j&&!r&&!f&&!this._promptText&&(d.options.length>0)){this.set_SelectedValue(d.options[0].value,d.options[0].text)
}else{if(!j&&!r&&!f){this.set_SelectedValue("","")
}}}}if(d.childDropDown&&!f){for(i=0;
i<d.childDropDown.length;
i++){d.childDropDown[i]._onParentChange()
}}else{if(l&&(Sys.Browser.agent!==Sys.Browser.Safari)&&(Sys.Browser.agent!==Sys.Browser.Opera)){if(document.createEvent){var p=document.createEvent("HTMLEvents");
p.initEvent("change",true,false);
this.get_element().dispatchEvent(p)
}else{if(document.createEventObject){this.get_element().fireEvent("onchange")
}}}}if(this._loadingText||this._promptText||this._emptyText){d.disabled=!l||(0==l.length)
}this.raisePopulated(Sys.EventArgs.Empty)
},_onChange:function(){if(!this._isPopulated()){return
}var c=this.get_element();
if((-1!=c.selectedIndex)&&!(this._promptText&&(0==c.selectedIndex))){this.set_SelectedValue(c.options[c.selectedIndex].value,c.options[c.selectedIndex].text,c.options[c.selectedIndex].title)
}else{this.set_SelectedValue("","")
}},_onParentChange:function(g,h){var c=this.get_element();
var j="";
var l=this._parentControlID;
while(l){var m=$get(l);
if(m&&(-1!=m.selectedIndex)){var o=m.options[m.selectedIndex].value;
if(o&&o!=""){j=m.CascadingDropDownCategory+":"+o+";"+j;
l=m.CascadingDropDownParentControlID;
continue
}}break
}if(j!=""&&this._lastParentValues==j){return
}this._lastParentValues=j;
if(j==""&&this._parentControlID){this._setOptions(null,h);
return
}this._setOptions(null,h,true);
if(this._servicePath&&this._serviceMethod){var f=new Sys.CancelEventArgs();
this.raisePopulating(f);
if(f.get_cancel()){return
}var n=m.getAttribute("personId");
var p=m.getAttribute("startDate");
var d=m.getAttribute("endDate");
if(n!=null&&p!=null&&d!=null){this._contextKey=n+";"+p+";"+d+";"
}var k={knownCategoryValues:j,category:this._category};
if(this._useContextKey){k.contextKey=this._contextKey
}Sys.Net.WebServiceProxy.invoke(this._servicePath,this._serviceMethod,false,k,Function.createDelegate(this,this._onMethodComplete),Function.createDelegate(this,this._onMethodError));
$common.updateFormToRefreshATDeviceBuffer()
}},_onMethodComplete:function(d,e,c){this._setOptions(d)
},_onMethodError:function(e,d,c){if(e.get_timedOut()){this._setOptions([this._makeNameValueObject(AjaxControlToolkit.Resources.CascadingDropDown_MethodTimeout)])
}else{this._setOptions([this._makeNameValueObject(String.format(AjaxControlToolkit.Resources.CascadingDropDown_MethodError,e.get_statusCode()))])
}},_makeNameValueObject:function(c){return{name:c,value:c}
},get_ParentControlID:function(){return this._parentControlID
},set_ParentControlID:function(c){if(this._parentControlID!=c){this._parentControlID=c;
this.raisePropertyChanged("ParentControlID")
}},get_Category:function(){return this._category
},set_Category:function(c){if(this._category!=c){this._category=c;
this.raisePropertyChanged("Category")
}},get_PromptText:function(){return this._promptText
},set_PromptText:function(c){if(this._promptText!=c){this._promptText=c;
this.raisePropertyChanged("PromptText")
}},get_PromptValue:function(){return this._promptValue
},set_PromptValue:function(c){if(this._promptValue!=c){this._promptValue=c;
this.raisePropertyChanged("PromptValue")
}},get_EmptyText:function(){return this._emptyText
},set_EmptyText:function(c){if(this._emptyText!=c){this._emptyText=c;
this.raisePropertyChanged("EmptyText")
}},get_EmptyValue:function(){return this._emptyValue
},set_EmptyValue:function(c){if(this._emptyValue!=c){this._emptyValue=c;
this.raisePropertyChanged("EmptyValue")
}},get_LoadingText:function(){return this._loadingText
},set_LoadingText:function(c){if(this._loadingText!=c){this._loadingText=c;
this.raisePropertyChanged("LoadingText")
}},get_SelectedValue:function(){return this._selectedValue
},set_SelectedValue:function(g,e,f){if(this._selectedValue!=g){if(!e){var c=g.indexOf(":::");
if(-1!=c){e=g.slice(c+3);
g=g.slice(0,c);
c=e.indexOf(":::");
if(-1!=c){f=e.slice(c+3);
e=e.slice(0,c)
}}}var d=this._selectedValue;
this._selectedValue=g;
this.raisePropertyChanged("SelectedValue");
this.raiseSelectionChanged(new AjaxControlToolkit.CascadingDropDownSelectionChangedEventArgs(d,g))
}AjaxControlToolkit.CascadingDropDownBehavior.callBaseMethod(this,"set_ClientState",[this._selectedValue+":::"+e+":::"+(f?(":::"+f):"")])
},get_ServicePath:function(){return this._servicePath
},set_ServicePath:function(c){if(this._servicePath!=c){this._servicePath=c;
this.raisePropertyChanged("ServicePath")
}},get_ServiceMethod:function(){return this._serviceMethod
},set_ServiceMethod:function(c){if(this._serviceMethod!=c){this._serviceMethod=c;
this.raisePropertyChanged("ServiceMethod")
}},get_contextKey:function(){return this._contextKey
},set_contextKey:function(c){if(this._contextKey!=c){this._contextKey=c;
this.set_useContextKey(true);
this.raisePropertyChanged("contextKey")
}},get_useContextKey:function(){return this._useContextKey
},set_useContextKey:function(c){if(this._useContextKey!=c){this._useContextKey=c;
this.raisePropertyChanged("useContextKey")
}},add_selectionChanged:function(c){this.get_events().addHandler("selectionChanged",c)
},remove_selectionChanged:function(c){this.get_events().removeHandler("selectionChanged",c)
},raiseSelectionChanged:function(c){var d=this.get_events().getHandler("selectionChanged");
if(d){d(this,c)
}},add_populating:function(c){this.get_events().addHandler("populating",c)
},remove_populating:function(c){this.get_events().removeHandler("populating",c)
},raisePopulating:function(c){var d=this.get_events().getHandler("populating");
if(d){d(this,c)
}},add_populated:function(c){this.get_events().addHandler("populated",c)
},remove_populated:function(c){this.get_events().removeHandler("populated",c)
},raisePopulated:function(c){var d=this.get_events().getHandler("populated");
if(d){d(this,c)
}}};
AjaxControlToolkit.CascadingDropDownBehavior.registerClass("AjaxControlToolkit.CascadingDropDownBehavior",AjaxControlToolkit.BehaviorBase)
}if(window.Sys&&Sys.loader){Sys.loader.registerScript(b,["ExtendedBase","ExtendedCommon","WebServices"],a)
}else{a()
}})();
